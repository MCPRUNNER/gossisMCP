{{/*
  Deployed Go html/template for Data Flow Analysis Report (used by render step)
  This file is intended to be rendered server-side with a data model like:
    type ReportPage struct {
      Title string
      Data  []map[string]interface{}
    }
*/}}
{{- $title := or .Title (index . "title") "Data Flow Analysis Report" -}}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ $title }}</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:1rem}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #ddd;padding:8px;vertical-align:top;text-align:left}
    th{background:#f7f7f7}
    pre.analysis{white-space:pre-wrap;font-family:monospace;margin:0;font-size:0.9em}
    caption{font-size:1.25rem;margin-bottom:.5rem;text-align:left}
    .package-name{font-weight:bold;color:#0066cc}
    .timestamp{font-size:0.85em;color:#666}
  </style>
</head>
<body>
  <h1>{{ $title }}</h1>
  <p>Data flow analysis from combined workflow output.</p>

  {{ $rows := index . "data" }}
  {{ if $rows }}
  <table aria-describedby="report-desc">
    <caption id="report-desc">Data Flow Analysis Results</caption>
    <thead>
      <tr>
        <th>Package</th>
        <th>File Path</th>
        <th>Status</th>
        <th>Analysis Results</th>
      </tr>
    </thead>
    <tbody>
{{ range $rows }}
      <tr>
        <td class="package-name">{{ index . "package" }}</td>
        <td>{{ index . "file_path" }}<br><span class="timestamp">{{ index . "timestamp" }}</span></td>
        <td>{{ index . "status" }}</td>
        <td><pre class="analysis">{{ index . "results" }}</pre></td>
      </tr>
{{ end }}
    </tbody>
  </table>
  {{ else }}
    {{- $file := index . "file_path" -}}
    {{- $pkg := index . "package" -}}
    {{- $results := index . "results" -}}
    {{- $status := index . "status" -}}
    {{- $timestamp := index . "timestamp" -}}
    <table aria-describedby="report-desc">
      <caption id="report-desc">Data Flow Analysis Results</caption>
      <thead>
        <tr>
          <th>Package</th>
          <th>File Path</th>
          <th>Status</th>
          <th>Analysis Results</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="package-name">{{ if $pkg }}{{ $pkg }}{{ else if $file }}{{ $file }}{{ else }}(unknown){{ end }}</td>
          <td>{{ $file }}{{ if $timestamp }}<br><span class="timestamp">{{ $timestamp }}</span>{{ end }}</td>
          <td>{{ $status }}</td>
          <td><pre class="analysis">{{ $results }}</pre></td>
        </tr>
      </tbody>
    </table>
  {{ end }}
</body>
</html>
