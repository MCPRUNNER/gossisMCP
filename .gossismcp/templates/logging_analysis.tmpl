{{/*
  Deployed Go html/template for Logging Analysis Report (used by render step)
  This file is intended to be rendered server-side with a data model like:
    type ReportPage struct {
      Title string
      Data  []map[string]interface{}
    }
*/}}
{{- $title := or .Title (index . "title") "Logging Analysis Report" -}}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ $title }}</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:1rem}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #ddd;padding:8px;vertical-align:top;text-align:left}
    th{background:#f7f7f7}
    pre.analysis{white-space:pre-wrap;font-family:monospace;margin:0}
    caption{font-size:1.25rem;margin-bottom:.5rem;text-align:left}
  </style>
</head>
<body>
  <h1>{{ $title }}</h1>
  <p>Package analysis from combined workflow output.</p>

  {{ $rows := or .Data (index . "data") }}
  {{ if not $rows }}
    <p><em>No records found.</em></p>
  {{ else }}
  <table aria-describedby="report-desc">
    <caption id="report-desc">Package analysis</caption>
    <thead>
      <tr>
        <th>Package</th>
        <th>File</th>
        <th>Analysis</th>
      </tr>
    </thead>
    <tbody>
    {{ range $i, $it := $rows }}
      {{- $file := "" -}}
      {{- $analysis := "" -}}
      {{- $pkg := "" -}}
      {{- if eq (printf "%T" $it) "map[string]interface {}" }}
        {{- $m := $it -}}
        {{- if index $m "file" }}{{ $file = index $m "file" }}{{ end -}}
        {{- if index $m "analysis" }}{{ $analysis = index $m "analysis" }}{{ end -}}
        {{- if index $m "package" }}{{ $pkg = index $m "package" }}{{ end -}}
      {{- else }}
        {{- with $it.File }}{{ $file = . }}{{ end }}
        {{- with $it.Analysis }}{{ $analysis = . }}{{ end }}
        {{- with $it.Package }}{{ $pkg = . }}{{ end }}
      {{- end }}
      <tr>
        <td>
          {{- if $pkg }}{{ $pkg }}{{ else if $file }}{{ $file }}{{ else }}(unknown){{ end }}
        </td>
        <td>{{ $file }}</td>
        <td><pre class="analysis">{{ $analysis }}</pre></td>
      </tr>
    {{ end }}
    </tbody>
  </table>
  {{ end }}
</body>
</html>
